<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–π –ú–∞–≥–∞–∑–∏–Ω - –ö–∞—Ç–∞–ª–æ–≥</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="/static/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <!-- Telegram Header (—Å—Ç–∞—Ç–∏—á–Ω—ã–π) -->
        <div class="telegram-header" style="background-color: rgb(255, 255, 255); --color-header-text: var(--color-text);">
            <button type="button" class="Button smaller translucent round" aria-label="Close" title="Close" onclick="closeBot()">
                <div class="RuJ3d9N6">
                    <svg width="20px" height="20px" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path>
                    </svg>
                </div>
            </button>
            <div class="modal-title">WHATWILLWEWEAR</div>
            <div class="DropdownMenu web-app-more-menu with-menu-transitions">
                <button type="button" class="Button kKPD09tc smaller translucent round" aria-label="More actions" title="More actions" onclick="toggleTelegramMenu()">
                    <i class="icon icon-more" aria-hidden="true">
                        <svg width="20px" height="20px" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"></path>
                        </svg>
                    </i>
                </button>
                <div class="Menu web-app-more-menu with-menu-transitions">
                    <div role="presentation" class="bubble menu-container custom-scroll opacity-transition fast not-shown not-open">
                        <div role="menuitem" tabindex="0" class="MenuItem">
                            <i class="icon icon-bots" aria-hidden="true">
                                <svg width="16px" height="16px" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path>
                                </svg>
                            </i>
                            Open Bot
                        </div>
                        <div role="menuitem" tabindex="0" class="MenuItem">
                            <i class="icon icon-reload" aria-hidden="true">
                                <svg width="16px" height="16px" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"></path>
                                </svg>
                            </i>
                            Reload Page
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <header class="catalog-header">
            <div class="header-content">
                <!-- –ö–Ω–æ–ø–∫–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –º–µ–Ω—é -->
                <div class="menu-btn" onclick="openMenu()">
                    <div class="hamburger">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
                
                <!-- –ù–∞–∑–≤–∞–Ω–∏–µ –±—Ä–µ–Ω–¥–∞ -->
                <div class="brand-container">
                    <span class="brand-name">W4STORE</span>
                </div>
                
                <!-- –ö–Ω–æ–ø–∫–∞ –ø–æ–∏—Å–∫–∞ -->
                <div class="search-btn" onclick="toggleSearch()">
                    üîç
                </div>
            </div>
        </header>

        <!-- –§–∏–ª—å—Ç—Ä—ã –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ -->
        <div class="filters-section">
            <!-- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ -->
            <div class="sort-container">
                <button class="sort-btn" onclick="toggleSortDropdown()">
                    <div class="sort-icon">
                        <svg width="16px" height="16px" viewBox="0 0 16 16" fill="var(--icon-primary)" xmlns="http://www.w3.org/2000/svg" class="" style="min-width: 16px; min-height: 16px;">
                            <path d="M10.7296 13.79C11.0201 14.07 11.4799 14.07 11.7704 13.79L14.5204 11.14C14.8187 10.8525 14.8275 10.3777 14.54 10.0795C14.2526 9.78121 13.7778 9.77243 13.4796 10.0599L12 11.4857L12 2.75C12 2.33579 11.6642 2 11.25 2C10.8358 2 10.5 2.33579 10.5 2.75L10.5 11.4857L9.02043 10.0599C8.72217 9.77243 8.24738 9.78121 7.95995 10.0795C7.67253 10.3777 7.68131 10.8525 7.97957 11.14L10.7296 13.79ZM5.28033 2.21967C4.98744 1.92678 4.51256 1.92678 4.21967 2.21967L1.46967 4.96967C1.17678 5.26256 1.17678 5.73744 1.46967 6.03033C1.76256 6.32322 2.23744 6.32322 2.53033 6.03033L4 4.56066V13.25C4 13.6642 4.33579 14 4.75 14C5.16421 14 5.5 13.6642 5.5 13.25V4.56066L6.96967 6.03033C7.26256 6.32322 7.73744 6.32322 8.03033 6.03033C8.32322 5.73744 8.32322 5.26256 8.03033 4.96967L5.28033 2.21967Z"></path>
                        </svg>
                    </div>
                </button>
                <div class="sort-dropdown-content" id="sortDropdown">
                    <div class="sort-item active" onclick="sortProducts('default')">–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é</div>
                    <div class="sort-item" onclick="sortProducts('new')">–ù–æ–≤–∏–Ω–∫–∏</div>
                    <div class="sort-item" onclick="sortProducts('price-asc')">–ü–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é —Ü–µ–Ω</div>
                    <div class="sort-item" onclick="sortProducts('price-desc')">–ü–æ —É–±—ã–≤–∞–Ω–∏—é —Ü–µ–Ω</div>
                </div>
            </div>
            
            <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
            <div class="category-dropdown">
                <button class="category-dropdown-btn" onclick="toggleCategoryDropdown()">
                    <span class="dropdown-text">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</span>
                    <span class="dropdown-arrow">‚ñº</span>
                </button>
                <div class="category-dropdown-content" id="categoryDropdown">
                    <div class="category-item active" onclick="filterByCategory('all')">–í—Å–µ —Ç–æ–≤–∞—Ä—ã</div>
                    <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
        </div>

        <!-- –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤ –≤ —Å—Ç–∏–ª–µ FASHION FABRIQUE -->
        <div class="products-container">
            <h2 class="section-title">–í—Å–µ —Ç–æ–≤–∞—Ä—ã</h2>
            <div class="products-grid" id="products-grid">
                {% for product in products %}
                    {% if product.stock > 0 %}
                <div class="product-card" data-category="{{ product.category }}" data-product-id="{{ product.id }}">
                    <!-- –ö–ª–∏–∫–∞–±–µ–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞ —Ç–æ–≤–∞—Ä–∞ -->
                    <div class="product-image-container" onclick="viewProduct('{{ product.original_id }}')">
                        {% if product.image %}
                        <img src="{{ product.image }}" alt="{{ product.name }}" class="product-image" loading="lazy" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div class="product-image-placeholder" style="display: none;">
                            <span class="image-placeholder-text">üì∑</span>
                        </div>
                        {% else %}
                        <div class="product-image-placeholder">
                            <span class="image-placeholder-text">üì∑</span>
                        </div>
                        {% endif %}
                    </div>
                    
                    <!-- –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–µ -->
                    <div class="product-info-simple">
                        <div class="product-price">‚ÇΩ{{ product.price }}</div>
                        <div class="product-name">{{ product.name }}</div>
                        <div class="product-sizes">{{ product.available_sizes|join(', ') if product.available_sizes else '–†–∞–∑–º–µ—Ä—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã' }}</div>
                        <div class="product-article" style="display: none;">–ê—Ä—Ç: {{ product.article|default('–ù–µ —É–∫–∞–∑–∞–Ω') }}</div>
                    </div>
                </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>

        <!-- –ü—É—Å—Ç–æ–π –∫–∞—Ç–∞–ª–æ–≥ -->
        <div class="empty-catalog" id="empty-catalog" style="display: none;">
            <div class="empty-icon">üîç</div>
            <h3>–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
            <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å, —Ñ–∏–ª—å—Ç—Ä—ã –∏–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</p>
            <button class="reset-filters-btn" onclick="resetFilters()">
                –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
            </button>
        </div>

        <!-- –ü–ª–∞–≤–∞—é—â–∞—è –∫–Ω–æ–ø–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã -->
        <div class="floating-cart" onclick="openCart()">
            üõí <span id="floating-cart-count">0</span>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–æ—Ä–∑–∏–Ω—ã -->
    <div class="modal" id="cart-modal">
        <div class="modal-content">
            <div class="modal-header" style="background-color: rgb(255, 255, 255); --color-header-text: var(--color-text);">
                <button type="button" class="Button smaller translucent round" aria-label="Back" title="Back" onclick="closeCart()">
                    <div class="RuJ3d9N6 IWA50OWU">
                        <svg width="20px" height="20px" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path>
                        </svg>
                    </div>
                </button>
                <div class="modal-title">WHATWILLWEWEAR</div>
                <div class="DropdownMenu web-app-more-menu with-menu-transitions">
                    <button type="button" class="Button kKPD09tc smaller translucent round" aria-label="More actions" title="More actions" onclick="toggleTelegramMenu()">
                        <i class="icon icon-more" aria-hidden="true">
                            <svg width="20px" height="20px" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"></path>
                            </svg>
                        </i>
                    </button>
                </div>
            </div>
            <div class="modal-body" id="cart-content">
                <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–æ—Ä–∑–∏–Ω—ã –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –º–µ–Ω—é -->
    <div class="menu-modal" id="menu-modal">
        <div class="menu-overlay" onclick="closeMenu()"></div>
        <div class="menu-content">
            <div class="menu-header" style="background-color: rgb(255, 255, 255); --color-header-text: var(--color-text);">
                <button type="button" class="Button smaller translucent round" aria-label="Back" title="Back" onclick="closeMenu()">
                    <div class="RuJ3d9N6 IWA50OWU">
                        <svg width="20px" height="20px" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path>
                        </svg>
                    </div>
                </button>
                <div class="modal-title">WHATWILLWEWEAR</div>
                <div class="DropdownMenu web-app-more-menu with-menu-transitions">
                    <button type="button" class="Button kKPD09tc smaller translucent round" aria-label="More actions" title="More actions">
                        <i class="icon icon-more" aria-hidden="true">
                            <svg width="20px" height="20px" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"></path>
                            </svg>
                        </i>
                    </button>
                </div>
            </div>
            <div class="menu-body">
                <div class="menu-item" onclick="showDeliveryInfo()">
                    <span class="menu-icon">üöö</span>
                    <span class="menu-text">–î–æ—Å—Ç–∞–≤–∫–∞ –∏ –≤–æ–∑–≤—Ä–∞—Ç</span>
                </div>
                <div class="menu-item" onclick="showPaymentInfo()">
                    <span class="menu-icon">üí≥</span>
                    <span class="menu-text">–û–ø–ª–∞—Ç–∞</span>
                </div>
                <div class="menu-item" onclick="showContacts()">
                    <span class="menu-icon">üìû</span>
                    <span class="menu-text">–ö–æ–Ω—Ç–∞–∫—Ç—ã</span>
                </div>
                <div class="menu-item" onclick="showSupport()">
                    <span class="menu-icon">üí¨</span>
                    <span class="menu-text">–ù–∞–ø–∏—Å–∞—Ç—å –Ω–∞–º</span>
                </div>
                <div class="menu-item" onclick="showPrivacyPolicy()">
                    <span class="menu-icon">üìÑ</span>
                    <span class="menu-text">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</span>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/app.js"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        if (window.Telegram && window.Telegram.WebApp) {
            const tg = window.Telegram.WebApp;
            tg.ready();
            tg.expand();
            
            // –ü–æ–ª—É—á–∞–µ–º ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram
            window.currentUserId = tg.initDataUnsafe?.user?.id || 'demo_user';
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –≥–ª–∞–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
            tg.MainButton.text = '–ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É';
            tg.MainButton.onClick(() => openCart());
        }

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
        let currentOffset = 0; // –ù–∞—á–∏–Ω–∞–µ–º —Å 0, —Ç–∞–∫ –∫–∞–∫ –∑–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ —Ç–æ–≤–∞—Ä—ã —Å—Ä–∞–∑—É
        let isLoading = false;
        let hasMore = false; // –ù–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ
        let currentCategory = 'all'; // –¢–µ–∫—É—â–∞—è –≤—ã–±—Ä–∞–Ω–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', () => {
            updateCartCount();
            setupInfiniteScroll();
            loadCategories(); // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            loadAllProducts(); // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ —Ç–æ–≤–∞—Ä—ã —Å—Ä–∞–∑—É
        });

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –º–µ–Ω—é
        function openMenu() {
            const menuModal = document.getElementById('menu-modal');
            menuModal.style.display = 'block';
            setTimeout(() => {
                menuModal.classList.add('show');
            }, 10);
        }

        function closeMenu() {
            const menuModal = document.getElementById('menu-modal');
            menuModal.classList.remove('show');
            setTimeout(() => {
                menuModal.style.display = 'none';
            }, 300);
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è Telegram Header
        function closeBot() {
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.close();
            } else {
                // Fallback –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞
                window.history.back();
            }
        }

        function toggleTelegramMenu() {
            const menu = document.querySelector('.telegram-header .Menu');
            if (menu) {
                menu.classList.toggle('not-shown');
                menu.classList.toggle('not-open');
            }
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ Telegram header –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –º–µ–Ω—é
        document.addEventListener('click', function(event) {
            const telegramHeader = document.querySelector('.telegram-header');
            const menu = document.querySelector('.telegram-header .Menu');
            if (telegramHeader && !telegramHeader.contains(event.target)) {
                if (menu) {
                    menu.classList.add('not-shown', 'not-open');
                }
            }
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–µ–Ω—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            const menu = document.querySelector('.telegram-header .Menu');
            if (menu) {
                menu.classList.add('not-shown', 'not-open');
            }
        });

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞
        function toggleSearch() {
            const header = document.querySelector('.catalog-header');
            const headerContent = document.querySelector('.header-content');
            
            if (header.classList.contains('search-mode')) {
                // –í—ã—Ö–æ–¥ –∏–∑ —Ä–µ–∂–∏–º–∞ –ø–æ–∏—Å–∫–∞
                header.classList.remove('search-mode');
                headerContent.innerHTML = `
                    <!-- –ö–Ω–æ–ø–∫–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –º–µ–Ω—é -->
                    <div class="menu-btn" onclick="openMenu()">
                        <div class="hamburger">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </div>
                    
                    <!-- –ù–∞–∑–≤–∞–Ω–∏–µ –±—Ä–µ–Ω–¥–∞ -->
                    <div class="brand-container">
                        <span class="brand-name">W4STORE</span>
                    </div>
                    
                    <!-- –ö–Ω–æ–ø–∫–∞ –ø–æ–∏—Å–∫–∞ -->
                    <div class="search-btn" onclick="toggleSearch()">
                        üîç
                    </div>
                `;
            } else {
                // –í—Ö–æ–¥ –≤ —Ä–µ–∂–∏–º –ø–æ–∏—Å–∫–∞
                header.classList.add('search-mode');
                headerContent.innerHTML = `
                    <div class="search-input-container">
                        <input type="text" id="header-search-input" placeholder="–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤..." onkeyup="performSearch(this.value)">
                        <button class="search-close-btn" onclick="toggleSearch()">‚úï</button>
                    </div>
                `;
                
                // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞
                setTimeout(() => {
                    document.getElementById('header-search-input').focus();
                }, 100);
            }
        }

        function performSearch(query) {
            const searchTerm = query.toLowerCase().trim();
            const productCards = document.querySelectorAll('.product-card');
            const emptyState = document.getElementById('empty-catalog');
            let visibleProducts = 0;

            productCards.forEach(card => {
                const productName = card.querySelector('.product-name').textContent.toLowerCase();
                const productSizes = card.querySelector('.product-sizes').textContent.toLowerCase();
                const productPrice = card.querySelector('.product-price').textContent.toLowerCase();
                const productArticle = card.querySelector('.product-article')?.textContent.toLowerCase() || '';
                const productId = card.getAttribute('data-product-id') || '';
                const productCategory = card.getAttribute('data-category') || '';

                if (productName.includes(searchTerm) || 
                    productSizes.includes(searchTerm) || 
                    productPrice.includes(searchTerm) ||
                    productArticle.includes(searchTerm) ||
                    productId.includes(searchTerm) ||
                    productCategory.includes(searchTerm)) {
                    card.style.display = 'block';
                    visibleProducts++;
                } else {
                    card.style.display = 'none';
                }
            });

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø—É—Å—Ç–æ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ
            if (visibleProducts === 0 && searchTerm.length > 0) {
                emptyState.style.display = 'block';
            } else {
                emptyState.style.display = 'none';
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
            updateProductCounter(visibleProducts);
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø—É–Ω–∫—Ç–æ–≤ –º–µ–Ω—é
        function showDeliveryInfo() {
            alert('–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç–∞–≤–∫–µ –∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–∑–∂–µ');
        }

        function showPaymentInfo() {
            alert('–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–ø–ª–∞—Ç–µ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–∑–∂–µ');
        }

        function showContacts() {
            alert('–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–∑–∂–µ');
        }

        function showSupport() {
            alert('–§–æ—Ä–º–∞ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–∑–∂–µ');
        }

        function showPrivacyPolicy() {
            alert('–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–∑–∂–µ');
        }

        // –§—É–Ω–∫—Ü–∏—è —Å–±—Ä–æ—Å–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤
        function resetFilters() {
            // –°–∫—Ä—ã–≤–∞–µ–º –ø—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            const emptyState = document.getElementById('empty-catalog');
            emptyState.style.display = 'none';
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–∏—Å–∫
            const searchInput = document.getElementById('header-search-input');
            if (searchInput) {
                searchInput.value = '';
            }
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é –Ω–∞ "–í—Å–µ —Ç–æ–≤–∞—Ä—ã"
            currentCategory = 'all';
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –≤ –≤—ã–ø–∞–¥–∞—é—â–µ–º —Å–ø–∏—Å–∫–µ
            document.querySelectorAll('.category-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector('.category-item').classList.add('active');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
            const dropdownText = document.querySelector('.dropdown-text');
            if (dropdownText) {
                dropdownText.textContent = '–ö–∞—Ç–µ–≥–æ—Ä–∏–∏';
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ —Ç–æ–≤–∞—Ä—ã
            const productCards = document.querySelectorAll('.product-card');
            productCards.forEach(card => {
                card.style.display = 'block';
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
            const title = document.querySelector('.section-title');
            if (title) {
                title.textContent = '–í—Å–µ —Ç–æ–≤–∞—Ä—ã';
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫
            updateProductCounter(productCards.length);
        }

        // –§—É–Ω–∫—Ü–∏—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤
        function sortProducts(sortType) {
            const productsGrid = document.getElementById('products-grid');
            const productCards = Array.from(productsGrid.querySelectorAll('.product-card'));
            const sortDropdown = document.getElementById('sortDropdown');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –≤ –≤—ã–ø–∞–¥–∞—é—â–µ–º —Å–ø–∏—Å–∫–µ
            sortDropdown.querySelectorAll('.sort-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫
            toggleSortDropdown();
            
            if (sortType === 'default') {
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–æ–≤–∞—Ä—ã –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ - –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
                location.reload();
                return;
            }
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º —Ç–æ–≤–∞—Ä—ã
            productCards.sort((a, b) => {
                const priceA = parseInt(a.querySelector('.product-price').textContent.replace(/[^\d]/g, ''));
                const priceB = parseInt(b.querySelector('.product-price').textContent.replace(/[^\d]/g, ''));
                const nameA = a.querySelector('.product-name').textContent.toLowerCase();
                const nameB = b.querySelector('.product-name').textContent.toLowerCase();
                
                switch(sortType) {
                    case 'price-asc':
                        return priceA - priceB;
                    case 'price-desc':
                        return priceB - priceA;
                    case 'new':
                        // –î–ª—è –Ω–æ–≤–∏–Ω–æ–∫ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ID –∏–ª–∏ –¥–∞—Ç—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
                        return 0; // –ü–æ–∫–∞ –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å
                    default:
                        return 0;
                }
            });
            
            // –ü–µ—Ä–µ—Å—Ç–∞–≤–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –≤ DOM
            productCards.forEach(card => {
                productsGrid.appendChild(card);
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
        function toggleCategoryDropdown() {
            const dropdown = document.getElementById('categoryDropdown');
            const categoryContainer = dropdown.parentElement;
            dropdown.classList.toggle('show');
            categoryContainer.classList.toggle('show');
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
        function toggleSortDropdown() {
            const sortContainer = document.querySelector('.sort-container');
            sortContainer.classList.toggle('show');
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —Å–ø–∏—Å–∫–æ–≤ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –∏—Ö
        document.addEventListener('click', function(event) {
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
            const categoryDropdown = document.getElementById('categoryDropdown');
            const categoryBtn = document.querySelector('.category-dropdown-btn');
            
            if (!categoryDropdown.contains(event.target) && !categoryBtn.contains(event.target)) {
                categoryDropdown.classList.remove('show');
                categoryBtn.parentElement.classList.remove('show');
            }
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
            const sortContainer = document.querySelector('.sort-container');
            const sortBtn = document.querySelector('.sort-btn');
            
            if (!sortContainer.contains(event.target)) {
                sortContainer.classList.remove('show');
            }
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏–∑ API
        async function loadCategories() {
            try {
                const response = await fetch('/api/categories-with-products');
                const data = await response.json();
                
                const dropdown = document.getElementById('categoryDropdown');
                const categories = data.categories || [];
                
                // –û—á–∏—â–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–∫—Ä–æ–º–µ "–í—Å–µ —Ç–æ–≤–∞—Ä—ã")
                const allItems = dropdown.querySelectorAll('.category-item:not(:first-child)');
                allItems.forEach(item => item.remove());
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–∑ API —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Ç–æ–≤–∞—Ä–æ–≤
                categories.forEach(category => {
                    const categoryItem = document.createElement('div');
                    categoryItem.className = 'category-item';
                    categoryItem.textContent = `${category.name} (${category.product_count})`;
                    categoryItem.onclick = () => filterByCategory(category.name);
                    dropdown.appendChild(categoryItem);
                });
                
                console.log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${categories.length} –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Å —Ç–æ–≤–∞—Ä–∞–º–∏`);
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π:', error);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
        function filterByCategory(category) {
            console.log('–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:', category);
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫
            document.getElementById('categoryDropdown').classList.remove('show');
            
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            document.querySelectorAll('.category-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —ç–ª–µ–º–µ–Ω—Ç—É
            event.target.classList.add('active');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
            const dropdownText = document.querySelector('.dropdown-text');
            if (category === 'all') {
                dropdownText.textContent = '–ö–∞—Ç–µ–≥–æ—Ä–∏–∏';
                currentCategory = 'all';
            } else {
                dropdownText.textContent = category;
                currentCategory = category;
            }
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
            currentOffset = 0;
            hasMore = true;
            
            // –û—á–∏—â–∞–µ–º —Å–µ—Ç–∫—É —Ç–æ–≤–∞—Ä–æ–≤
            const productsGrid = document.getElementById('products-grid');
            productsGrid.innerHTML = '';
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–≤–∞—Ä—ã –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            loadMoreProducts();
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ (–≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω–∞)
        function setupInfiniteScroll() {
            // –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω–æ
            /*
            window.addEventListener('scroll', () => {
                if (isLoading || !hasMore) return;
                
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                const windowHeight = window.innerHeight;
                const documentHeight = document.documentElement.scrollHeight;
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –±–æ–ª—å—à–µ —Ç–æ–≤–∞—Ä–æ–≤ –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏–±–ª–∏–∂–∞–µ—Ç—Å—è –∫ –∫–æ–Ω—Ü—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                if (scrollTop + windowHeight >= documentHeight - 500) {
                    loadMoreProducts();
                }
            });
            */
        }
        
                        // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤ —Å—Ä–∞–∑—É
        async function loadAllProducts() {
            if (isLoading) return;
            
            console.log('–ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ —Ç–æ–≤–∞—Ä—ã...');
            isLoading = true;
            
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ —Ç–æ–≤–∞—Ä—ã —Å—Ä–∞–∑—É
                const response = await fetch('/api/products?limit=1000&offset=0');
                const data = await response.json();
                
                if (data.products && data.products.length > 0) {
                    // –û—á–∏—â–∞–µ–º —Å–µ—Ç–∫—É —Ç–æ–≤–∞—Ä–æ–≤
                    const productsGrid = document.getElementById('products-grid');
                    productsGrid.innerHTML = '';
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ —Ç–æ–≤–∞—Ä—ã –≤ —Å–µ—Ç–∫—É
                    data.products.forEach(product => {
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä—ã —Å –æ—Å—Ç–∞—Ç–∫–∞–º–∏
                        if (product.stock > 0) {
                            const productCard = createProductCard(product);
                            productsGrid.appendChild(productCard);
                        }
                    });
                    
                    console.log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${data.products.length} —Ç–æ–≤–∞—Ä–æ–≤`);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ —Ç–æ–≤–∞—Ä–æ–≤
                    const title = document.querySelector('.section-title');
                    if (title) {
                        title.textContent = '–í—Å–µ —Ç–æ–≤–∞—Ä—ã';
                    }
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤:', error);
            } finally {
                isLoading = false;
            }
        }

                // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ (–¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º)
        async function loadMoreProducts() {
            if (isLoading || !hasMore) return;
            
            console.log(`–ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–≤–∞—Ä—ã: offset=${currentOffset}, category=${currentCategory}, isLoading=${isLoading}, hasMore=${hasMore}`);
            isLoading = true;
            
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ —Ç–æ–≤–∞—Ä—ã –∏ —Ñ–∏–ª—å—Ç—Ä—É–µ–º –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                const response = await fetch('/api/products?limit=1000&offset=0');
                const data = await response.json();
                
                if (data.products && data.products.length > 0) {
                    // –û—á–∏—â–∞–µ–º —Å–µ—Ç–∫—É —Ç–æ–≤–∞—Ä–æ–≤
                    const productsGrid = document.getElementById('products-grid');
                    productsGrid.innerHTML = '';
                    
                    let filteredCount = 0;
                    
                    data.products.forEach(product => {
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä—ã —Å –æ—Å—Ç–∞—Ç–∫–∞–º–∏
                        if (product.stock > 0) {
                            // –§–∏–ª—å—Ç—Ä—É–µ–º –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞
                            if (currentCategory === 'all' || 
                                product.category === currentCategory) {
                                const productCard = createProductCard(product);
                                productsGrid.appendChild(productCard);
                                filteredCount++;
                            }
                        }
                    });
                    
                    console.log(`‚úÖ –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ ${filteredCount} —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "${currentCategory}"`);
                    
                                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ —Ç–æ–≤–∞—Ä–æ–≤
            const title = document.querySelector('.section-title');
            if (title) {
                const categoryText = currentCategory === 'all' ? '–í—Å–µ —Ç–æ–≤–∞—Ä—ã' : currentCategory;
                title.textContent = categoryText;
            }
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤:', error);
            } finally {
                isLoading = false;
            }
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–∞
        function createProductCard(product) {
            const card = document.createElement('div');
            card.className = 'product-card';
            card.setAttribute('data-category', product.category || '');
            card.setAttribute('data-product-id', product.id || '');
            
            const imageHtml = product.image 
                ? `<img src="${product.image}" alt="${product.name}" class="product-image" loading="lazy" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">`
                : '';
            
            const placeholderHtml = `<div class="product-image-placeholder" style="display: ${product.image ? 'none' : 'flex'};">üì∑</div>`;
            
            card.innerHTML = `
                <div class="product-image-container" onclick="viewProduct('${product.original_id || product.id}')">
                    ${imageHtml}
                    ${placeholderHtml}
                </div>
                <div class="product-info-simple">
                    <div class="product-price">‚ÇΩ${product.price}</div>
                    <div class="product-name">${product.name}</div>
                    <div class="product-sizes">${product.available_sizes && product.available_sizes.length > 0 ? product.available_sizes.join(', ') : '–†–∞–∑–º–µ—Ä—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã'}</div>
                    <div class="product-article" style="display: none;">–ê—Ä—Ç: ${product.article || '–ù–µ —É–∫–∞–∑–∞–Ω'}</div>
                </div>
            `;
            
            return card;
        }
    </script>
</body>
</html>
