<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ product.name }} - –ú–æ–π –ú–∞–≥–∞–∑–∏–Ω</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.css">
    <style>
        :root {
            --backgroundSecondary: #ffffff;
            --backgroundBottomBar: #ffffff;
            --text-primary: #1a1a1a;
            --text-secondary: #666666;
            --buttonBgPrimary: #1a1a1a;
            --buttonBgPrimaryAccented: #333333;
            --iconPrimary: #1a1a1a;
            --icon-on-color-enabled: #ffffff;
        }

        .ProductPage {
            background: var(--backgroundSecondary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding-top: 72px;
        }

        .sectionContainer {
            position: relative;
            width: 100%;
            height: 100%;
            padding: 0 20px;
            background: #f8f8f8;
        }

        .PDPImageSwiper {
            width: 100%;
            height: 100%;
            min-height: 400px;
            background: #f8f8f8;
        }

        .swiper-slide img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
        }

        .swiper-pagination {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
        }

        .swiper-pagination-bullet {
            width: 10px;
            height: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 50%;
            margin: 0 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .swiper-pagination-bullet-active {
            background: #1a1a1a;
            transform: scale(1.2);
        }

        .share {
            background: rgba(0, 0, 0, 0.25);
            border-radius: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            top: 16px;
            right: 16px;
            z-index: 50;
            transition: all 0.3s ease;
        }

        .share:hover {
            background: rgba(0, 0, 0, 0.4);
            transform: scale(1.05);
        }

        .ProductPage_container {
            background: #fff;
            padding: 24px;
            margin: 0 20px;
            border-radius: 0;
            box-shadow: none;
            border: none;
        }

        .PDPAttributeContainer {
            margin-top: -20px;
            position: relative;
        }

        .attribute-group {
            margin-bottom: 20px;
        }

        .attribute-label {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 8px;
            display: inline;
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            padding: 4px 8px;
        }

        .attribute-value {
            font-size: 14px;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            color: var(--text-primary);
            font-weight: 600;
            margin-bottom: 12px;
            display: inline;
        }

        .attribute-options {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .option-button {
            padding: 8px 16px;
            border: none;
            border-radius: 0;
            background: #fff;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
            font-weight: 500;
        }

        .option-button:hover {
            border-color: #666666;
        }

        .option-button.selected {
            border-color: #000000;
            background: #000000;
            color: #fff;
        }

        .option-button.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            text-decoration: line-through;
        }

        .product-title {
            font-size: 19px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 16px;
            line-height: 1.4;
        }

        .product-price {
            font-size: 22px !important;
            font-weight: 700 !important;
            color: var(--text-primary) !important;
            margin-bottom: 20px !important;
        }

        .product-description {
            margin-bottom: 20px;
        }

        .description-title {
            font-size: 14px;
            font-weight: 600;
            color: #666666;
            margin-bottom: 12px;
        }

        .description-content {
            font-size: 14px;
            color: #000000;
            line-height: 1.6;
            margin-bottom: 8px;
        }

        .read-more {
            display: flex;
            align-items: center;
            gap: 4px;
            color: #007bff;
            cursor: pointer;
            font-size: 14px;
            margin-top: 8px;
        }

        .support-section {
            text-align: center;
        }

        .support-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 16px;
        }

        .support-button {
            background: #f0f0f0;
            color: #666666;
            border: none;
            padding: 16px 20px;
            border-radius: 0;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .bottomButtonWrapper_tdesktop {
            background: var(--backgroundBottomBar);
            padding: 16px;
            border-top: none;
            position: sticky;
            bottom: 0;
        }

        .add-to-cart-button {
            background: var(--buttonBgPrimary);
            color: #fff;
            border: none;
            padding: 18px 24px;
            border-radius: 0;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: none;
        }

        .add-to-cart-button:hover {
            background: var(--buttonBgPrimaryAccented);
            transform: translateY(-2px);
            box-shadow: none;
        }

        .add-to-cart-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }





        .error-message {
            color: #dc3545;
            font-size: 14px;
            margin-top: 8px;
            text-align: center;
        }

        .success-message {
            color: #28a745;
            font-size: 14px;
            margin-top: 8px;
            text-align: center;
        }

        .product-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
            line-height: 1.3;
            margin-bottom: 8px;
        }

        .product-price {
            font-size: 22px !important;
            font-weight: 700 !important;
            color: var(--text-primary) !important;
            font-family: 'Inter', sans-serif !important;
        }

        .description-title {
            font-size: 16px;
            font-weight: 600;
            color: #666666;
            font-family: 'Inter', sans-serif;
            margin-bottom: 12px;
        }

        .description-content {
            font-size: 16px;
            color: var(--text-secondary);
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
        }

        .option-button {
            background: #f8f8f8;
            border: none;
            color: var(--text-primary);
            padding: 12px 16px;
            border-radius: 0;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
        }

        .option-button:hover {
            background: #f0f0f0;
            border-color: #1a1a1a;
        }

        .option-button.selected {
            background: #1a1a1a;
            color: #ffffff;
            border-color: #1a1a1a;
        }

        @media (max-width: 768px) {
            .PDPImageSwiper {
                height: 600px;
            }
            
            .ProductPage_container {
                margin: 0 12px;
                padding: 16px;
            }
        }
        
        @media (max-width: 480px) {
            .PDPImageSwiper {
                height: 550px;
            }
            
            .ProductPage_container {
                margin: 0 8px;
                padding: 12px;
            }
        }
    </style>
</head>
<body>
    <!-- Telegram Header (—Å—Ç–∞—Ç–∏—á–Ω—ã–π) -->
    <div class="telegram-header" style="background-color: rgb(255, 255, 255); --color-header-text: var(--color-text); position: fixed; top: 0; left: 0; right: 0; z-index: 1000;">
            <button type="button" class="Button smaller translucent round" aria-label="Back" title="Back" onclick="goBack()">
                <div class="RuJ3d9N6">
                    <svg width="20px" height="20px" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path>
                    </svg>
                </div>
            </button>
            <div class="modal-title">WHATWILLWEWEAR</div>
            <div class="DropdownMenu web-app-more-menu with-menu-transitions">
                <button type="button" class="Button kKPD09tc smaller translucent round" aria-label="More actions" title="More actions" onclick="toggleTelegramMenu()">
                    <i class="icon icon-more" aria-hidden="true">
                        <svg width="20px" height="20px" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"></path>
                        </svg>
                    </i>
                </button>
                <div class="Menu web-app-more-menu with-menu-transitions">
                    <div role="presentation" class="bubble menu-container custom-scroll opacity-transition fast not-shown not-open">
                        <div role="menuitem" tabindex="0" class="MenuItem">
                            <i class="icon icon-bots" aria-hidden="true">
                                <svg width="16px" height="16px" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path>
                                </svg>
                            </i>
                            Open Bot
                        </div>
                        <div role="menuitem" tabindex="0" class="MenuItem">
                            <i class="icon icon-reload" aria-hidden="true">
                                <svg width="16px" height="16px" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"></path>
                                </svg>
                            </i>
                            Reload Page
                        </div>
                    </div>
                </div>
            </div>
        </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
    <div class="ProductPage">
            <div class="flex flex-col grow overflow-auto gap-5">
                
                <!-- –ì–∞–ª–µ—Ä–µ—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
                <div class="relative sectionContainer">
                    <div class="swiper swiper-initialized swiper-horizontal PDPImageSwiper relative">
                        <div class="swiper-wrapper">
                            {% if product.image %}
                            <div class="swiper-slide swiper-slide-active">
                                <img class="w-full h-full" loading="lazy" src="{{ product.image }}" alt="{{ product.name }}">
                            </div>
                            {% else %}
                            <div class="swiper-slide swiper-slide-active">
                                <div class="product-image-placeholder">üì∑</div>
                            </div>
                            {% endif %}
                        </div>
                        <div class="swiper-pagination swiper-pagination-bullets swiper-pagination-horizontal">
                            <span class="swiper-pagination-bullet swiper-pagination-bullet-active"></span>
                        </div>
                        <button class="share" onclick="shareProduct()" style="position: absolute; top: 16px; right: 16px; z-index: 50; color: #ffffff; border: none; padding: 8px; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s ease;">
                            <svg width="20px" height="20px" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path d="M13 4.4932C13 4.05265 13.5289 3.82775 13.8467 4.13285L20.624 10.6397C20.8287 10.8365 20.8289 11.1637 20.624 11.3604L13.8467 17.8672C13.529 18.1719 13.0004 17.947 13 17.5069V14C7.02671 13 4 18 4 18C4 12.4772 7.47715 8.00003 13 8.00003V4.4932Z"></path>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- –ê—Ç—Ä–∏–±—É—Ç—ã —Ç–æ–≤–∞—Ä–∞ -->
                <div class="flex flex-col ProductPage_container gap-4 PDPAttributeContainer">
                    
                    <!-- –í—ã–±–æ—Ä —Ü–≤–µ—Ç–∞ -->
                    <div class="flex flex-col gap-2">
                        <span class="attribute-label">–¶–≤–µ—Ç: <span class="attribute-value" id="selected-color">–í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç</span></span>
                        <div class="flex flex-row gap-2 flex-wrap attribute-options" id="color-options" style="padding: 8px 0;">

                            {% if product.available_colors %}
                                {% for color in product.available_colors %}
                                <button class="option-button color-option" data-color="{{ color }}" onclick="selectColor('{{ color }}')">
                                    {{ color }}
                                </button>
                                {% endfor %}
                            {% else %}
                                <span style="color: #666666; padding: 4px 8px; font-size: 14px;">–¶–≤–µ—Ç –Ω–µ —É–∫–∞–∑–∞–Ω</span>
                            {% endif %}
                        </div>
                    </div>

                    <!-- –í—ã–±–æ—Ä —Ä–∞–∑–º–µ—Ä–∞ -->
                    <div class="flex flex-col gap-2">
                        <span class="attribute-label">–†–∞–∑–º–µ—Ä: <span class="attribute-value" id="selected-size">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–º–µ—Ä</span></span>
                        <div class="flex flex-row gap-2 flex-wrap attribute-options" id="size-options" style="padding: 8px 0;">

                            {% if product.available_sizes %}
                                {% for size in product.available_sizes %}
                                <button class="option-button size-option" data-size="{{ size }}" onclick="selectSize('{{ size }}')">
                                    {{ size }}
                                </button>
                                {% endfor %}
                            {% else %}
                                <span style="color: #666666; padding: 4px 8px; font-size: 14px;">–†–∞–∑–º–µ—Ä –Ω–µ —É–∫–∞–∑–∞–Ω</span>
                            {% endif %}
                        </div>
                    </div>

                </div>
                
                <!-- –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –ø–æ—Å–ª–µ –∞—Ç—Ä–∏–±—É—Ç–æ–≤ -->
                <div style="height: 6px; background-color: #f0f0f0; margin: 12px 0;"></div>

                <!-- –û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ -->
                <div class="flex flex-col gap-4 ProductPage_container Description">
                    <div class="flex flex-col gap-2">
                        <span class="product-title">{{ product.name }}</span>
                        <div class="flex flex-row gap-2 items-baseline">
                            <span class="product-price">{{ "%.0f"|format(product.price) }} ‚ÇΩ</span>
                        </div>
                        <!-- –û—Ç—Å—Ç—É–ø –ø–æ—Å–ª–µ —Ü–µ–Ω—ã -->
                        <div style="margin-bottom: 16px;"></div>
                    </div>
                    
                    <div class="flex flex-col gap-2">
                        <span class="description-title">–û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</span>
                        <div>
                            <div class="description-content">
                                <span style="color: #000000; font-size: 13px; margin-bottom: 0; display: block;">–ê—Ä—Ç. {{ product.article or '–ù–µ —É–∫–∞–∑–∞–Ω' }}</span>
                                <div>
                                    <p style="color: #000000; font-size: 13px; margin-bottom: 0;">{{ product.description or '–û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç' }}</p>
                                    {% if product.modifications %}
                                    <p><strong>–î–æ—Å—Ç—É–ø–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:</strong></p>
                                    <ul>
                                        {% for mod, stock in product.modifications.items() %}
                                        <li>{{ mod }} - {{ stock }} —à—Ç.</li>
                                        {% endfor %}
                                    </ul>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-row gap-1 cursor-pointer read-more" onclick="toggleDescription()">
                            <span>–ß–∏—Ç–∞—Ç—å –¥–∞–ª—å—à–µ</span>
                            <svg width="16px" height="16px" viewBox="0 0 16 16" fill="var(--text-secondary)" xmlns="http://www.w3.org/2000/svg">
                                <path d="M2.29289 5.28989C2.68342 4.89937 3.31658 4.89937 3.70711 5.28989L8 9.58279L12.2929 5.28989C12.6834 5.68042 14.0976 6.31358 13.7071 6.70411L8.70711 11.7041C8.31658 12.0946 7.68342 12.0946 7.29289 11.7041L2.29289 6.70411C1.90237 6.31358 1.90237 5.68042 2.29289 5.28989Z"></path>
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –ø–µ—Ä–µ–¥ –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π -->
                <div style="height: 6px; background-color: #f0f0f0; margin: 12px 0;"></div>

                <!-- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ -->
                <div class="flex flex-col gap-4 ProductPage_container support-section">
                    <span class="support-title">–û—Å—Ç–∞–ª–∏—Å—å –≤–æ–ø—Ä–æ—Å—ã?</span>
                    <button class="support-button" onclick="openTelegramChat()">–ù–∞–ø–∏—Å–∞—Ç—å –í–∞–ª–µ–Ω—Ç–∏–Ω–µ</button>
                </div>

                <!-- –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –ø–æ—Å–ª–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ -->
                <div style="height: 6px; background-color: #f0f0f0; margin: 12px 0;"></div>

            </div>

            <!-- –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å —Å –∫–Ω–æ–ø–∫–æ–π –∫–æ—Ä–∑–∏–Ω—ã -->
            <div class="bg-backgroundBottomBar">
                <div class="ProductPage_bottomButtonWrapper bottomButtonWrapper_tdesktop">
                    <div class="flex gap-4 h-full" id="cart-buttons-container" style="width: 100%;">
                        <button class="add-to-cart-button" id="add-to-cart-btn" onclick="showQuantitySelector()" disabled>
                            –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
                        </button>
                        <div class="cart-after-add" id="cart-after-add" style="display: none; width: 100%;">
                            <div style="display: flex; flex-direction: column; width: 100%; height: 100%; gap: 8px;">

                                <div style="display: flex; flex-direction: row; width: 100%; height: 100%;">
                                    <div class="quantity-counter" style="width: 30%; display: flex; align-items: center; justify-content: center; background: #f5f5f5; border-radius: 8px 0 0 8px; margin: 0; border: none;">
                                        <button class="quantity-btn minus-btn" onclick="decreaseQuantity()" style="background: none; border: none; font-size: 20px; font-weight: bold; color: #666; cursor: pointer; padding: 8px 12px; border-radius: 4px; transition: all 0.3s ease; opacity: 0.5;" disabled>-</button>
                                        <span id="selected-quantity" style="padding: 0 16px; font-size: 16px; font-weight: 600; color: #1a1a1a; min-width: 40px; text-align: center;">1</span>
                                        <button class="quantity-btn plus-btn" onclick="increaseQuantity()" style="background: none; border: none; font-size: 20px; font-weight: bold; color: #666; cursor: pointer; padding: 8px 12px; border-radius: 4px; transition: all 0.3s ease;">+</button>
                                    </div>
                                    <button class="go-to-cart-button" onclick="addToCart()" style="width: 70%; background: #333333; color: #ffffff; border: none; padding: 18px 24px; border-radius: 0 8px 8px 0; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; margin: 0; margin-left: 0;">
                                        –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <a class="cart-icon" href="/cart" id="cart-icon">
                        <div class="cart-count" id="cart-count">0</div>
                        <svg width="24px" height="24px" viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg">
                            <path d="M7.00003 6.99994C7.00006 4.23854 9.23863 2 12 2C14.7615 2 17 4.23858 17 7L17.9182 7C18.4057 6.99999 18.8233 6.99998 19.1662 7.0244C19.5247 7.04993 19.8844 7.10612 20.2332 7.26246C21.0139 7.61241 21.608 8.27901 21.8662 9.09464C21.9815 9.45903 21.9961 9.82278 21.9804 10.1819C21.9654 10.5253 21.9175 10.9402 21.8616 11.4245L21.4083 15.3553C21.2163 17.0252 21.0884 18.1369 20.6207 19.038C19.9989 20.2358 18.9584 21.1631 17.6973 21.6436C16.7486 22.005 15.6295 22.0046 13.9486 22.0039H10.0493C8.36895 22.0046 7.25025 22.005 6.30176 21.6437C5.0409 21.1635 4.00054 20.2366 3.37857 19.0393C2.91069 18.1386 2.7825 17.0273 2.58995 15.3581L2.13496 11.4259C2.07889 10.9415 2.03086 10.5265 2.0157 10.183C1.99985 9.8238 2.01432 9.45994 2.1296 9.09543C2.38761 8.27954 2.98176 7.61267 3.76258 7.26257C4.11143 7.10616 4.47121 7.04995 4.82983 7.02441C5.17283 6.99998 5.5906 6.99999 6.07825 7L7.00003 6.99994ZM12 4C10.3432 4 9.00005 5.34312 9.00003 6.99996L15 7C15 5.34315 13.6569 4 12 4ZM16.8048 12.2499C16.942 11.7149 16.6196 11.17 16.0847 11.0327C15.5497 10.8955 15.0048 11.2178 14.8675 11.7528C14.535 13.0486 13.3645 14 11.9799 14C10.5953 14 9.42476 13.0486 9.09225 11.7528C8.95498 11.2178 8.41003 10.8955 7.87508 11.0327C7.34012 11.17 7.01774 11.7149 7.15501 12.2499C7.70754 14.4031 9.65453 16 11.9799 16C14.3052 16 16.2522 14.4031 16.8048 12.2499Z" fill="white"></path>
                        </svg>
                    </a>
                </div>
            </div>

        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.js"></script>
    <script>
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è Telegram Header
        function goBack() {
            window.history.back();
        }

        function toggleTelegramMenu() {
            const menu = document.querySelector('.telegram-header .Menu');
            if (menu) {
                menu.classList.toggle('not-shown');
                menu.classList.toggle('not-open');
            }
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ Telegram header –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –º–µ–Ω—é
        document.addEventListener('click', function(event) {
            const telegramHeader = document.querySelector('.telegram-header');
            const menu = document.querySelector('.telegram-header .Menu');
            if (telegramHeader && !telegramHeader.contains(event.target)) {
                if (menu) {
                    menu.classList.add('not-shown', 'not-open');
                }
            }
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–µ–Ω—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            const menu = document.querySelector('.telegram-header .Menu');
            if (menu) {
                menu.classList.add('not-shown', 'not-open');
            }
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Swiper
        const swiper = new Swiper('.PDPImageSwiper', {
            pagination: {
                el: '.swiper-pagination',
                clickable: true,
            },
        });

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –≤—ã–±–æ—Ä–∞
        let selectedColor = null;
        let selectedSize = null;
        let selectedQuantity = 1;
        
        // –î–∞–Ω–Ω—ã–µ –æ –≤–∞—Ä–∏–∞–Ω—Ç–∞—Ö —Ç–æ–≤–∞—Ä–∞ (–ø–æ–ª—É—á–∞–µ–º –∏–∑ Jinja2)
        const productVariants = {{ product.variants | tojson | safe }};
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏
        function getMaxAvailableQuantity(color, size) {
            if (!productVariants) return 1;
            
            const hasColors = {% if product.available_colors %}true{% else %}false{% endif %};
            const hasSizes = {% if product.available_sizes %}true{% else %}false{% endif %};
            
            // –ï—Å–ª–∏ —É —Ç–æ–≤–∞—Ä–∞ –µ—Å—Ç—å –∏ —Ü–≤–µ—Ç, –∏ —Ä–∞–∑–º–µ—Ä - –∏—â–µ–º —Ç–æ—á–Ω—É—é –∫–æ–º–±–∏–Ω–∞—Ü–∏—é
            if (hasColors && hasSizes) {
                for (const variant of productVariants) {
                    if (variant.colors.includes(color) && variant.sizes.includes(size)) {
                        return variant.stock || 1;
                    }
                }
            }
            
            // –ï—Å–ª–∏ —É —Ç–æ–≤–∞—Ä–∞ –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ —Ü–≤–µ—Ç - –∏—â–µ–º –ø–æ —Ü–≤–µ—Ç—É
            if (hasColors && !hasSizes && color) {
                for (const variant of productVariants) {
                    if (variant.colors.includes(color)) {
                        return variant.stock || 1;
                    }
                }
            }
            
            // –ï—Å–ª–∏ —É —Ç–æ–≤–∞—Ä–∞ –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ —Ä–∞–∑–º–µ—Ä - –∏—â–µ–º –ø–æ —Ä–∞–∑–º–µ—Ä—É
            if (!hasColors && hasSizes && size) {
                for (const variant of productVariants) {
                    if (variant.sizes.includes(size)) {
                        return variant.stock || 1;
                    }
                }
            }
            
            // –ï—Å–ª–∏ —É —Ç–æ–≤–∞—Ä–∞ –Ω–µ—Ç –Ω–∏ —Ü–≤–µ—Ç–∞, –Ω–∏ —Ä–∞–∑–º–µ—Ä–∞ - –±–µ—Ä–µ–º –æ–±—â–∏–π stock
            if (!hasColors && !hasSizes) {
                const totalStock = productVariants.reduce((sum, variant) => sum + (variant.stock || 0), 0);
                return totalStock || 1;
            }
            
            return 1;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –æ–ø—Ü–∏–π
        function updateOptionAvailability() {
            if (!productVariants) return;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ü–≤–µ—Ç–æ–≤
            document.querySelectorAll('.color-option').forEach(colorBtn => {
                const color = colorBtn.dataset.color;
                let hasAvailableSize = false;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –¥–ª—è —ç—Ç–æ–≥–æ —Ü–≤–µ—Ç–∞
                for (const variant of productVariants) {
                    if (variant.colors.includes(color) && variant.stock > 0) {
                        hasAvailableSize = true;
                        break;
                    }
                }
                
                if (hasAvailableSize) {
                    colorBtn.classList.remove('unavailable');
                    colorBtn.disabled = false;
                } else {
                    colorBtn.classList.add('unavailable');
                    colorBtn.disabled = true;
                }
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ä–∞–∑–º–µ—Ä–æ–≤
            document.querySelectorAll('.size-option').forEach(sizeBtn => {
                const size = sizeBtn.dataset.size;
                let hasAvailableColor = false;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ü–≤–µ—Ç–∞ –¥–ª—è —ç—Ç–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
                for (const variant of productVariants) {
                    if (variant.sizes.includes(size) && variant.stock > 0) {
                        hasAvailableColor = true;
                        break;
                    }
                }
                
                if (hasAvailableColor) {
                    sizeBtn.classList.remove('unavailable');
                    sizeBtn.disabled = false;
                } else {
                    sizeBtn.classList.add('unavailable');
                    sizeBtn.disabled = true;
                }
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –æ–ø—Ü–∏–π —Å —É—á–µ—Ç–æ–º —É–∂–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö
        function updateOptionAvailabilityWithSelection() {
            if (!productVariants) return;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ü–≤–µ—Ç–æ–≤ —Å —É—á–µ—Ç–æ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
            document.querySelectorAll('.color-option').forEach(colorBtn => {
                const color = colorBtn.dataset.color;
                let isAvailable = false;
                
                if (selectedSize) {
                    // –ï—Å–ª–∏ —Ä–∞–∑–º–µ—Ä —É–∂–µ –≤—ã–±—Ä–∞–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ —Å —ç—Ç–∏–º —Ä–∞–∑–º–µ—Ä–æ–º
                    for (const variant of productVariants) {
                        if (variant.colors.includes(color) && variant.sizes.includes(selectedSize) && variant.stock > 0) {
                            isAvailable = true;
                            break;
                        }
                    }
                } else {
                    // –ï—Å–ª–∏ —Ä–∞–∑–º–µ—Ä –Ω–µ –≤—ã–±—Ä–∞–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—â—É—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ü–≤–µ—Ç–∞
                    for (const variant of productVariants) {
                        if (variant.colors.includes(color) && variant.stock > 0) {
                            isAvailable = true;
                            break;
                        }
                    }
                }
                
                if (isAvailable) {
                    colorBtn.classList.remove('unavailable');
                    colorBtn.disabled = false;
                } else {
                    colorBtn.classList.add('unavailable');
                    colorBtn.disabled = true;
                }
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ä–∞–∑–º–µ—Ä–æ–≤ —Å —É—á–µ—Ç–æ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞
            document.querySelectorAll('.size-option').forEach(sizeBtn => {
                const size = sizeBtn.dataset.size;
                let isAvailable = false;
                
                if (selectedColor) {
                    // –ï—Å–ª–∏ —Ü–≤–µ—Ç —É–∂–µ –≤—ã–±—Ä–∞–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ —Å —ç—Ç–∏–º —Ü–≤–µ—Ç–æ–º
                    for (const variant of productVariants) {
                        if (variant.sizes.includes(size) && variant.colors.includes(selectedColor) && variant.stock > 0) {
                            isAvailable = true;
                            break;
                        }
                    }
                } else {
                    // –ï—Å–ª–∏ —Ü–≤–µ—Ç –Ω–µ –≤—ã–±—Ä–∞–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—â—É—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ä–∞–∑–º–µ—Ä–∞
                    for (const variant of productVariants) {
                        if (variant.sizes.includes(size) && variant.stock > 0) {
                            isAvailable = true;
                            break;
                        }
                    }
                }
                
                if (isAvailable) {
                    sizeBtn.classList.remove('unavailable');
                    sizeBtn.disabled = false;
                } else {
                    sizeBtn.classList.add('unavailable');
                    sizeBtn.disabled = true;
                }
            });
        }
        

        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
        function updateQuantityLimits() {
            const minusBtn = document.querySelector('.minus-btn');
            const plusBtn = document.querySelector('.plus-btn');
            const quantitySpan = document.getElementById('selected-quantity');
            
            const hasColors = {% if product.available_colors %}true{% else %}false{% endif %};
            const hasSizes = {% if product.available_sizes %}true{% else %}false{% endif %};
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—ã–±—Ä–∞–Ω—ã –ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã
            let canUpdateQuantity = true;
            
            if (hasColors && !selectedColor) {
                canUpdateQuantity = false;
            }
            
            if (hasSizes && !selectedSize) {
                canUpdateQuantity = false;
            }
            
            // –ï—Å–ª–∏ –∞—Ç—Ä–∏–±—É—Ç—ã –Ω–µ –≤—ã–±—Ä–∞–Ω—ã, –±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏
            if (!canUpdateQuantity) {
                selectedQuantity = 1;
                quantitySpan.textContent = selectedQuantity;
                minusBtn.disabled = true;
                plusBtn.disabled = true;
                minusBtn.style.opacity = '0.5';
                plusBtn.style.opacity = '0.5';
                return;
            }
            
            // –ü–æ–ª—É—á–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –¥–æ—Å—Ç—É–ø–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
            const maxQuantity = getMaxAvailableQuantity(selectedColor, selectedSize);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, –µ—Å–ª–∏ –æ–Ω–æ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –º–∞–∫—Å–∏–º—É–º
            if (selectedQuantity > maxQuantity) {
                selectedQuantity = maxQuantity;
                quantitySpan.textContent = selectedQuantity;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
            minusBtn.disabled = selectedQuantity <= 1;
            plusBtn.disabled = selectedQuantity >= maxQuantity;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –∫–Ω–æ–ø–æ–∫
            minusBtn.style.opacity = selectedQuantity <= 1 ? '0.5' : '1';
            plusBtn.style.opacity = selectedQuantity >= maxQuantity ? '0.5' : '1';
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
        function increaseQuantity() {
            const hasColors = {% if product.available_colors %}true{% else %}false{% endif %};
            const hasSizes = {% if product.available_sizes %}true{% else %}false{% endif %};
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—ã–±—Ä–∞–Ω—ã –ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã
            if (hasColors && !selectedColor) {
                return;
            }
            
            if (hasSizes && !selectedSize) {
                return;
            }
            
            // –ü–æ–ª—É—á–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –¥–æ—Å—Ç—É–ø–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
            const maxQuantity = getMaxAvailableQuantity(selectedColor, selectedSize);
            if (selectedQuantity < maxQuantity) {
                selectedQuantity++;
                document.getElementById('selected-quantity').textContent = selectedQuantity;
                updateQuantityLimits();
            }
        }
        
        function decreaseQuantity() {
            const hasColors = {% if product.available_colors %}true{% else %}false{% endif %};
            const hasSizes = {% if product.available_sizes %}true{% else %}false{% endif %};
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—ã–±—Ä–∞–Ω—ã –ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã
            if (hasColors && !selectedColor) {
                return;
            }
            
            if (hasSizes && !selectedSize) {
                return;
            }
            
            if (selectedQuantity > 1) {
                selectedQuantity--;
                document.getElementById('selected-quantity').textContent = selectedQuantity;
                updateQuantityLimits();
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –≤—ã–±–æ—Ä–∞ —Ü–≤–µ—Ç–∞
        function selectColor(color) {
            selectedColor = color;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            document.getElementById('selected-color').textContent = color;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏
            document.querySelectorAll('.color-option').forEach(btn => {
                btn.classList.remove('selected');
                if (btn.dataset.color === color) {
                    btn.classList.add('selected');
                }
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –æ–ø—Ü–∏–π –∏ –ª–∏–º–∏—Ç—ã –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
            updateOptionAvailabilityWithSelection();
            updateQuantityLimits();
            
            checkCanAddToCart();
        }

        // –§—É–Ω–∫—Ü–∏—è –≤—ã–±–æ—Ä–∞ —Ä–∞–∑–º–µ—Ä–∞
        function selectSize(size) {
            selectedSize = size;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            document.getElementById('selected-size').textContent = size;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏
            document.querySelectorAll('.size-option').forEach(btn => {
                btn.classList.remove('selected');
                if (btn.dataset.size === size) {
                    btn.classList.add('selected');
                }
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –æ–ø—Ü–∏–π –∏ –ª–∏–º–∏—Ç—ã –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
            updateOptionAvailabilityWithSelection();
            updateQuantityLimits();
            
            checkCanAddToCart();
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É
        function checkCanAddToCart() {
            const addButton = document.getElementById('add-to-cart-btn');
            const hasColors = {% if product.available_colors %}true{% else %}false{% endif %};
            const hasSizes = {% if product.available_sizes %}true{% else %}false{% endif %};
            
            let canAdd = true;
            let message = '–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É';
            
            if (hasColors && !selectedColor) {
                canAdd = false;
                message = '–í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç';
            }
            
            if (hasSizes && !selectedSize) {
                canAdd = false;
                if (hasColors && !selectedColor) {
                    message = '–í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç –∏ —Ä–∞–∑–º–µ—Ä';
                } else {
                    message = '–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–º–µ—Ä';
                }
            }
            
            // –ï—Å–ª–∏ –Ω–µ—Ç –Ω–∏ —Ü–≤–µ—Ç–∞, –Ω–∏ —Ä–∞–∑–º–µ—Ä–∞, —Ç–æ —Ç–æ–≤–∞—Ä –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –±–µ–∑ –≤—ã–±–æ—Ä–∞
            if (!hasColors && !hasSizes) {
                canAdd = true;
                message = '–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É';
            }
            
            addButton.disabled = !canAdd;
            addButton.textContent = message;
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–µ–ª–µ–∫—Ç–æ—Ä –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ (–Ω–µ –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ –∫–æ—Ä–∑–∏–Ω—É)
        function showQuantitySelector() {
            const hasColors = {% if product.available_colors %}true{% else %}false{% endif %};
            const hasSizes = {% if product.available_sizes %}true{% else %}false{% endif %};
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—ã–±—Ä–∞–Ω—ã –ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã
            if (hasColors && !selectedColor) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç');
                return;
            }
            
            if (hasSizes && !selectedSize) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–º–µ—Ä');
                return;
            }

            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫–∏ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–ª–µ–∫—Ç–æ—Ä –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
            document.getElementById('add-to-cart-btn').style.display = 'none';
            document.getElementById('cart-after-add').style.display = 'block';
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫ 1 –ø—Ä–∏ –ø–æ–∫–∞–∑–µ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞
            selectedQuantity = 1;
            document.getElementById('selected-quantity').textContent = selectedQuantity;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ª–∏–º–∏—Ç—ã –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
            updateQuantityLimits();
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω—É (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É")
        async function addToCart() {
            const hasColors = {% if product.available_colors %}true{% else %}false{% endif %};
            const hasSizes = {% if product.available_sizes %}true{% else %}false{% endif %};
            
            if (hasColors && !selectedColor) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç');
                return;
            }
            
            if (hasSizes && !selectedSize) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–º–µ—Ä');
                return;
            }

            try {
                const response = await fetch('/api/add-to-cart', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_id: window.currentUserId || 'demo_user',
                        product_id: '{{ product.original_id }}',
                        color: selectedColor,
                        size: selectedSize,
                        quantity: selectedQuantity || 1
                    })
                });

                                            if (response.ok) {
                                const result = await response.json();
                                if (result.success) {
                                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –∫–æ—Ä–∑–∏–Ω—ã —Å —Å–µ—Ä–≤–µ—Ä–∞
                                    await updateCartCountFromServer();

                                    // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –∫–æ—Ä–∑–∏–Ω—É
                                    window.location.href = '/cart';
                                } else {
                                    showMessage(result.message || '–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É', 'error');
                                }
                            } else {
                                showMessage('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É', 'error');
                            }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                showMessage('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É', 'error');
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã
        function updateCartCount(count) {
            const cartCountElement = document.getElementById('cart-count');
            if (cartCountElement) {
                cartCountElement.textContent = count;
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
        function showMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'success' ? 'success-message' : 'error-message';
            messageDiv.textContent = message;
            
            const addButton = document.getElementById('add-to-cart-btn');
            addButton.parentNode.insertBefore(messageDiv, addButton.nextSibling);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
        function shareProduct() {
            if (navigator.share) {
                navigator.share({
                    title: '{{ product.name }}',
                    text: '–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä!',
                    url: window.location.href
                });
            } else {
                // Fallback –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–æ–≤ –±–µ–∑ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ Web Share API
                navigator.clipboard.writeText(window.location.href).then(() => {
                    alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
                });
            }
        }

        function goToCart() {
            window.location.href = '/cart';
        }
        
        function contactSupport() {
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –¥–ª—è —Å–≤—è–∑–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π
            alert('–§—É–Ω–∫—Ü–∏—è —Å–≤—è–∑–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–∑–∂–µ');
        }

        function openTelegramChat() {
            // –û—Ç–∫—Ä—ã–≤–∞–µ–º —á–∞—Ç —Å @valentinav4 –≤ Telegram
            const telegramUrl = 'https://t.me/valentinav4';
            
            // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ Telegram WebApp, –∏—Å–ø–æ–ª—å–∑—É–µ–º tg.openTelegramLink
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.openTelegramLink(telegramUrl);
            } else {
                // Fallback –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞ - –æ—Ç–∫—Ä—ã–≤–∞–µ–º –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ
                window.open(telegramUrl, '_blank');
            }
        }

        function toggleDescription() {
            const content = document.querySelector('.description-content');
            const button = document.querySelector('.read-more span');
            const icon = document.querySelector('.read-more svg');
            
            if (content.style.maxHeight) {
                content.style.maxHeight = null;
                button.textContent = '–ß–∏—Ç–∞—Ç—å –¥–∞–ª—å—à–µ';
                icon.style.transform = 'rotate(0deg)';
            } else {
                content.style.maxHeight = content.scrollHeight + 'px';
                button.textContent = '–°–≤–µ—Ä–Ω—É—Ç—å';
                icon.style.transform = 'rotate(180deg)';
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
            if (window.Telegram && window.Telegram.WebApp) {
                const tg = window.Telegram.WebApp;
                tg.ready();
                tg.expand();
                
                // –ü–æ–ª—É—á–∞–µ–º ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram
                window.currentUserId = tg.initDataUnsafe?.user?.id || 'demo_user';
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω–µ
            updateCartCountFromServer();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –æ–ø—Ü–∏–π
            updateOptionAvailabilityWithSelection();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É
            checkCanAddToCart();
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω–µ —Å —Å–µ—Ä–≤–µ—Ä–∞
        async function updateCartCountFromServer() {
            try {
                const userId = window.currentUserId || 'demo_user';
                const response = await fetch(`/api/cart/${userId}`);
                if (response.ok) {
                    const cart = await response.json();
                    const count = cart.cart_items ? cart.cart_items.reduce((total, item) => total + item.quantity, 0) : 0;
                    updateCartCount(count);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ—Ä–∑–∏–Ω—ã:', error);
                // –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º 0
                updateCartCount(0);
            }
        }
    </script>
</body>
</html>
