<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ—Ä–∑–∏–Ω–∞ - {{ shop_name }}</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="cart-page">

        <!-- Telegram Header (–∫–∞—Å—Ç–æ–º–Ω—ã–π, –∫–∞–∫ —É FASHION FABRIQUE) -->
        <div class="telegram-header">
            <button type="button" class="Button smaller translucent round" aria-label="Back" title="Back" onclick="goBack()">
                <div class="RuJ3d9N6">
                    <svg width="20px" height="20px" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path>
                    </svg>
                </div>
            </button>
            <div class="modal-title">W4STORE</div>
            <div class="DropdownMenu web-app-more-menu with-menu-transitions">
                <button type="button" class="Button kKPD09tc smaller translucent round" aria-label="More actions" title="More actions" onclick="toggleTelegramMenu()">
                    <i class="icon icon-more" aria-hidden="true">
                        <svg width="20px" height="20px" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"></path>
                        </svg>
                    </i>
                </button>
                <div class="Menu web-app-more-menu with-menu-transitions">
                    <div role="presentation" class="bubble menu-container custom-scroll opacity-transition fast">
                        <div role="menuitem" tabindex="0" class="MenuItem">
                            <i class="icon icon-bots" aria-hidden="true">
                                <svg width="16px" height="16px" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path>
                                </svg>
                            </i>
                            Open Bot
                        </div>
                        <div role="menuitem" tabindex="0" class="MenuItem">
                            <i class="icon icon-reload" aria-hidden="true">
                                <svg width="16px" height="16px" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"></path>
                                </svg>
                            </i>
                            Reload Page
                        </div>
                    </div>
                </div>
            </div>
        </div>





        <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–æ—Ä–∑–∏–Ω—ã -->
        <div class="cart-content">
            <h1 class="page-heading">–ö–æ—Ä–∑–∏–Ω–∞</h1>
            {% if cart_items %}
                <!-- –¢–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω–µ -->
                <div class="cart-items">
                    {% for item in cart_items %}
                    <div class="cart-item" data-product-id="{{ item.product_id }}">
                                                    <!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ -->
                            <div class="cart-item-image">
                                {% if item.image %}
                                <img src="{{ item.image }}" alt="{{ item.name }}" class="cart-item-image-real" loading="lazy" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                <div class="cart-item-image-placeholder" style="display: none;">üì∑</div>
                                {% else %}
                                <div class="cart-item-image-placeholder">üì∑</div>
                                {% endif %}
                            </div>
                        
                        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–µ -->
                        <div class="cart-item-info">
                            <h3 class="cart-item-name">{{ item.name }}</h3>
                            <div class="cart-item-details">
                                <div class="cart-item-price">{{ "{:,.0f}".format(item.price) }} {{ currency }}</div>
                                <div class="cart-item-quantity">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: {{ item.quantity }}</div>
                            </div>
                        </div>
                        
                        <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏–µ–º -->
                        <div class="cart-item-controls">
                            <!-- –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ç–æ–≤–∞—Ä–∞ -->
                            <div class="cart-item-total">
                                {{ "{:,.0f}".format(item.price * item.quantity) }} {{ currency }}
                            </div>
                            
                            <!-- –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è -->
                            <button class="remove-btn" onclick="removeFromCart('{{ item.product_id }}')" title="–£–¥–∞–ª–∏—Ç—å">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                    {% endfor %}
                </div>

                <!-- –ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞ -->
                <div class="cart-summary">
                    <div class="summary-row">
                        <span>–¢–æ–≤–∞—Ä—ã ({{ cart_items|length }} —à—Ç.)</span>
                        <span>{{ "{:,.0f}".format(total) }} {{ currency }}</span>
                    </div>
                    <div class="summary-row">
                        <span>–î–æ—Å—Ç–∞–≤–∫–∞</span>
                        <span>–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</span>
                    </div>
                    <div class="summary-row total">
                        <span>–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ</span>
                        <span id="cart-total">{{ "{:,.0f}".format(total) }} {{ currency }}</span>
                    </div>
                </div>

            {% else %}
                <!-- –ü—É—Å—Ç–∞—è –∫–æ—Ä–∑–∏–Ω–∞ -->
                <div class="empty-cart">
                    <div class="empty-cart-icon">üõí</div>
                    <h2>–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</h2>
                    <p>–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞, —á—Ç–æ–±—ã –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</p>
                    <button class="continue-shopping-btn" onclick="goToCatalog()">
                        üõçÔ∏è –ü–µ—Ä–µ–π—Ç–∏ –∫ –ø–æ–∫—É–ø–∫–∞–º
                    </button>
                </div>
            {% endif %}
        </div>

        <!-- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –≤–Ω–∏–∑—É (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å —Ç–æ–≤–∞—Ä—ã) -->
        {% if cart_items %}
        <div class="cart-bottom-actions">
            <button class="cart-action-btn clear-cart-btn" onclick="clearCart()">
                üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å
            </button>
            <button class="cart-action-btn checkout-btn" onclick="checkout()">
                üí≥ –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑
            </button>
        </div>
        {% endif %}
    </div>

    <script src="/static/js/app.js"></script>
    <script>
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è Telegram Header
        function closeBot() {
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.close();
            } else {
                // Fallback –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞
                window.history.back();
            }
        }



        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        if (window.Telegram && window.Telegram.WebApp) {
            const tg = window.Telegram.WebApp;
            
            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
            try {
                tg.expand();
                tg.setHeaderColor('transparent');
                tg.setBackgroundColor('transparent');
                tg.MainButton.hide();
                tg.BackButton.hide();
            } catch (e) {
                console.log('Telegram WebApp API –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è:', e);
            }
            
            tg.ready();
            
            window.currentUserId = tg.initDataUnsafe?.user?.id || 'demo_user';
            
            {% if cart_items %}
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –≥–ª–∞–≤–Ω—É—é –∫–Ω–æ–ø–∫—É –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞
            tg.MainButton.text = '–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑ ({{ "{:,.0f}".format(total) }} {{ currency }})';
            tg.MainButton.show();
            tg.MainButton.onClick(() => checkout());
            {% endif %}
        }

        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–∫—Ä—ã–≤–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π Telegram header
        function hideTelegramHeader() {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ header
            const selectors = [
                '.telegram-webapp-header',
                '[data-testid="web-app-header"]',
                '[data-testid="web-app-header-title"]',
                '[data-testid="web-app-header-button"]',
                '.telegram-webapp-main-button',
                '.telegram-webapp-back-button',
                'header[class*="telegram"]',
                'div[class*="telegram-header"]',
                'div[class*="web-app-header"]'
            ];
            
            selectors.forEach(selector => {
                const elements = document.querySelectorAll(selector);
                elements.forEach(el => {
                    el.style.display = 'none';
                    el.style.visibility = 'hidden';
                    el.style.opacity = '0';
                    el.style.height = '0';
                    el.style.overflow = 'hidden';
                });
            });
            
            // –£–±–∏—Ä–∞–µ–º –æ—Ç—Å—Ç—É–ø—ã —Å–≤–µ—Ä—Ö—É
            document.documentElement.style.marginTop = '0';
            document.documentElement.style.paddingTop = '0';
            document.body.style.marginTop = '0';
            document.body.style.paddingTop = '0';
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º —Å–∫—Ä—ã—Ç–∏–µ header'–∞
        hideTelegramHeader();
        
        // –ü–æ–≤—Ç–æ—Ä—è–µ–º —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
        setInterval(hideTelegramHeader, 100);
        setTimeout(hideTelegramHeader, 500);
        setTimeout(hideTelegramHeader, 1000);



        function removeFromCart(productId) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã?')) {
                console.log('Removing from cart:', productId);
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
                fetch('/api/remove-from-cart', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_id: 'demo_user',
                        product_id: productId
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        location.reload();
                    } else {
                        alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞');
                });
            }
        }

        function clearCart() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É?')) {
                console.log('Clearing cart');
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –æ—á–∏—Å—Ç–∫—É –∫–æ—Ä–∑–∏–Ω—ã
                fetch('/api/clear-cart', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_id: 'demo_user'
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        location.reload();
                    } else {
                        alert('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∫–æ—Ä–∑–∏–Ω—ã: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∫–æ—Ä–∑–∏–Ω—ã');
                });
            }
        }

        function checkout() {
            // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞
            alert('–§—É–Ω–∫—Ü–∏—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–∑–∂–µ');
        }

        function goToCatalog() {
            window.location.href = '/';
        }

        function goBack() {
            goToCatalog();
        }

        function toggleTelegramMenu() {
            const menu = document.querySelector('.telegram-header .Menu');
            if (menu) {
                menu.classList.toggle('show');
            }
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ Telegram header –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –º–µ–Ω—é
        document.addEventListener('click', function(event) {
            const telegramHeader = document.querySelector('.telegram-header');
            const menu = document.querySelector('.telegram-header .Menu');
            if (telegramHeader && !telegramHeader.contains(event.target)) {
                if (menu) {
                    menu.classList.remove('show');
                }
            }
        });
    </script>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –º–µ–Ω—é -->
    <div class="menu-modal" id="menu-modal">
        <div class="menu-overlay" onclick="closeMenu()"></div>
        <div class="menu-content">
            <div class="menu-header">
                <h2>–ú–µ–Ω—é</h2>
                <button class="close-btn" onclick="closeMenu()">&times;</button>
            </div>
            <div class="menu-body">
                <div class="menu-item" onclick="showDeliveryInfo()">
                    <span class="menu-icon">üöö</span>
                    <span class="menu-text">–î–æ—Å—Ç–∞–≤–∫–∞ –∏ –≤–æ–∑–≤—Ä–∞—Ç</span>
                </div>
                <div class="menu-item" onclick="showPaymentInfo()">
                    <span class="menu-icon">üí≥</span>
                    <span class="menu-text">–û–ø–ª–∞—Ç–∞</span>
                </div>
                <div class="menu-item" onclick="showContacts()">
                    <span class="menu-icon">üìû</span>
                    <span class="menu-text">–ö–æ–Ω—Ç–∞–∫—Ç—ã</span>
                </div>
                <div class="menu-item" onclick="showSupport()">
                    <span class="menu-icon">üí¨</span>
                    <span class="menu-text">–ù–∞–ø–∏—Å–∞—Ç—å –Ω–∞–º</span>
                </div>
                <div class="menu-item" onclick="showPrivacyPolicy()">
                    <span class="menu-icon">üìÑ</span>
                    <span class="menu-text">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –º–µ–Ω—é
        function openMenu() {
            const menuModal = document.getElementById('menu-modal');
            menuModal.style.display = 'block';
            setTimeout(() => {
                menuModal.classList.add('show');
            }, 10);
        }

        function closeMenu() {
            const menuModal = document.getElementById('menu-modal');
            menuModal.classList.remove('show');
            setTimeout(() => {
                menuModal.style.display = 'none';
            }, 300);
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø—É–Ω–∫—Ç–æ–≤ –º–µ–Ω—é
        function showDeliveryInfo() {
            alert('–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç–∞–≤–∫–µ –∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–∑–∂–µ');
        }

        function showPaymentInfo() {
            alert('–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–ø–ª–∞—Ç–µ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–∑–∂–µ');
        }

        function showContacts() {
            alert('–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–∑–∂–µ');
        }

        function showSupport() {
            alert('–§–æ—Ä–º–∞ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–∑–∂–µ');
        }

        function showPrivacyPolicy() {
            alert('–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–∑–∂–µ');
        }
    </script>
</body>
</html>
